<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Mon site{% endblock %}</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <nav>
        <a href="{% url 'communication:inbox' %}">ğŸ“¥ Inbox</a> |
        <a href="{% url 'communication:sent' %}">ğŸ“¤ EnvoyÃ©s</a> |
        <a href="{% url 'communication:compose' %}">ğŸ“ Nouveau message</a> |
        <span id="notif">
            ğŸ”” <span id="unread-count">0</span>
        </span>
    </nav>
    <hr>
    {% block content %}{% endblock %}

    <script>
    const wsProtocol = window.location.protocol === "https:" ? "wss" : "ws";
    const wsUrl = `${wsProtocol}://${window.location.host}/ws/notifications/`;
    const notifSocket = new WebSocket(wsUrl);

    notifSocket.onmessage = function(e) {
        const data = JSON.parse(e.data);
        document.getElementById("unread-count").innerText = data.count;
        alert(data.message); // Popup simple (tu peux amÃ©liorer avec un toast)
    };
    </script>
</body>
</html>
